<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flowchart Decision Tool</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f4f4; margin:0; padding:0; }
  .tab-bar {
    display: flex;
    border-bottom: 2px solid #ccc;
    background: #f4f4f4;
  }
  .tab-bar a {
    padding: 10px 20px;
    text-decoration: none;
    color: black;
    border: 1px solid #ccc;
    border-bottom: none;
    background: #f9f9f9;
    margin-right: 5px;
    border-radius: 5px 5px 0 0;
  }
  .tab-bar a.active { background: white; font-weight: bold; border-bottom: 2px solid white; }
  .container { max-width: 700px; margin: 40px auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.15);}
  h1 { text-align: center; }
  .form-group { margin-bottom: 20px; display:none; }
  label { display:block; margin-bottom:5px; }
  select { width:100%; padding:10px; font-size:16px; }
  .result { display:none; margin-top:20px; background:#d4edda; border:1px solid #c3e6cb; padding:15px; border-radius:6px; color:#155724; font-weight:bold; text-align:center; }
</style>
</head>
<body>

<!-- Tab Navigation -->
<div class="tab-bar">
  <a href="index.html">Overview</a>
  <a href="flowchart.html" class="active">Flowchart</a>
  <a href="histogram.html">Histogram Viewer</a>
  <a href="code and examples.html">Code and Examples</a>
  <a href="R package.html">R Package</a>
</div>

<div class="container">
  <h1>Flowchart Decision Tool</h1>

  <!-- Step 0a1 -->
  <div class="form-group" id="step0a1">
    <label>Step 0a: Is it feasible to leverage field or natural experiments, rich observational data, or IVs?</label>
    <select id="feasible_design" onchange="handleStep0a1Change()">
      <option value="">Select…</option>
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>
  </div>

  <!-- Step 0a2 -->
  <div class="form-group" id="step0a2">
    <label>Do experiments balance or rich data capture all confounders? Are IVs strong and do they meet the meet ER condition?</label>
    <select id="valid_design" onchange="handleStep0a2Change()">
      <option value="">Select…</option>
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>
  </div>

  <!-- Step 0b -->
  <div class="form-group" id="step0b">
    <label>Step 0b: Consider endogeneity source: are Assumptions 1 & 2 in Table 4 of the copula correction plausible? See item in Table 4</label>
    <select id="endo_source" onchange="handleStep0bChange()">
      <option value="">Select…</option>
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>
  </div>

  <!-- Step 1 -->
  <div class="form-group" id="step1">
    <label>Step 1: Is Pₘₐᵢₙ continuous?</label>
    <select id="p_main_continuous" onchange="handleStep1Change()">
      <option value="">Select…</option>
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>
  </div>

  <!-- Step 2 -->
  <div class="form-group" id="step2">
    <label>Step 2: Is Pₘₐᵢₙ normally distributed?</label>
    <select id="p_main_normal" onchange="handleStep2Change()">
      <option value="">Select…</option>
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>
  </div>

  <!-- Step 3 -->
  <div class="form-group" id="step3">
    <label id="step3a" style="display:none;">
      Step 3a: Is Pₘₐᵢₙ correlated with any term in W?
      <select id="correlation" onchange="handleStep3Change()">
        <option value="">Select…</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
    </label>

    <label id="step3b" style="display:none;">
      Step 3b: Is at least one exogenous W continuous, sufficiently non-normal, and sufficiently relevant?
      <select id="exogenous_w" onchange="handleStep3Change()">
        <option value="">Select…</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
    </label>
  </div>

  <div class="result" id="result"></div>
</div>

<script>
  function appendNote(msg) {
      return `<div style="text-align:center;">${msg}<br>Check potential model nonidentification or misspecification issues. Revise model specification or copula correction strategy if needed.</div>`;
  }

  function resetDownstream(ids) {
    ids.forEach(id => {
      const el = document.getElementById(id);
      if(el.tagName === "SELECT") el.value = "";
      else if(el.tagName === "DIV" || el.tagName === "LABEL") el.style.display = "none";
    });
    document.getElementById("result").style.display = "none";
  }

  function handleStep0a1Change() {
    resetDownstream([
        "step0a2","step0b","step1","step2","step3",
        "valid_design","endo_source",
        "p_main_continuous","p_main_normal",
        "correlation","exogenous_w"
    ]);

    const val = document.getElementById("feasible_design").value;
    if(val === "yes") {
        document.getElementById("step0a2").style.display = "block";
        document.getElementById("valid_design").value = "";
    } else if(val === "no") {
        document.getElementById("step0b").style.display = "block";
        document.getElementById("endo_source").value = "";
    }
  }

  function handleStep0a2Change() {
    resetDownstream(["step0b","step1","step2","step3","p_main_continuous","p_main_normal","correlation","exogenous_w"]);
    const val = document.getElementById("valid_design").value;
    if(val === "yes") {
        document.getElementById("result").style.display = "block";
        document.getElementById("result").textContent = "Analyze data assuming no endogenous regressors (or use IV for endogenous regressors).";
    } else if(val === "no") {
        document.getElementById("step0b").style.display = "block";
        document.getElementById("endo_source").value = "";
    }
  }

  function handleStep0bChange() {
    resetDownstream(["step1","step2","step3","p_main_continuous","p_main_normal","correlation","exogenous_w"]);
    const val = document.getElementById("endo_source").value;
    if(val === "no") {
        document.getElementById("result").style.display = "block";
        document.getElementById("result").textContent = "Consider other IV-free methods (LIV, HM, IH, SORE).";
    } else if(val === "yes") {
        document.getElementById("step1").style.display = "block";
        document.getElementById("p_main_continuous").value = "";
    }
  }

  function handleStep1Change() {
    resetDownstream(["step2","step3","p_main_normal","correlation","exogenous_w"]);
    const val = document.getElementById("p_main_continuous").value;
    if(val === "no") {
        document.getElementById("result").style.display = "block";
        document.getElementById("result").textContent = "Use SORE (Qian & Xie 2024)";
    } else if(val === "yes") {
        document.getElementById("step2").style.display = "block";
        document.getElementById("p_main_normal").value = "";
    }
  }

  function handleStep2Change() {
    resetDownstream(["step3","correlation","exogenous_w"]);
    const val = document.getElementById("p_main_normal").value;
    document.getElementById("step3").style.display = "block";
    document.getElementById("step3a").style.display = val === "no" ? "block" : "none";
    document.getElementById("step3b").style.display = val === "yes" ? "block" : "none";
    if(val === "no") document.getElementById("correlation").value = "";
    if(val === "yes") document.getElementById("exogenous_w").value = "";
  }

  function handleStep3Change() {
    const P_norm = document.getElementById("p_main_normal").value === "yes";
    const corr = document.getElementById("correlation").value === "yes";
    const w_exog = document.getElementById("exogenous_w").value === "yes";

    let message = "";
    if(P_norm) {
        message = w_exog ? "2sCOPE" : "Check potential bias via of 2sCOPE using bootstrap";
    } else {
        message = corr ? "2sCOPE or MLE (Haschka or SORE)" : "P&G or BMW";
    }

    if(message) {
        document.getElementById("result").style.display = "block";
        document.getElementById("result").innerHTML = appendNote(message);
    }
  }

  document.getElementById("step0a1").style.display = "block";
</script>

</body>
</html>
